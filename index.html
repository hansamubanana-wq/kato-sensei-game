<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¶ã‚‹ã¶ã‚‹åŠ è—¤å…ˆç”Ÿ</title>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'DotGothic16', sans-serif; background-color: #ffe0b2; text-align: center; user-select: none; color: #4e342e; }
        
        /* ã¶ã‚‹ã¶ã‚‹éœ‡ãˆã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes buruburu {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-2px, 2px) rotate(-2deg); }
            50% { transform: translate(2px, -2px) rotate(2deg); }
            75% { transform: translate(-2px, -2px) rotate(-1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        .shaking { animation: buruburu 0.2s infinite; display: inline-block; }

        .container {
            max-width: 360px; margin: 0 auto; background: #fff8e1;
            border: 4px solid #8d6e63; border-radius: 20px; padding: 15px;
            box-shadow: 0 8px 0 #5d4037;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ */
        .header { display: flex; justify-content: space-between; background: #ffcc80; padding: 5px 10px; border-radius: 10px; font-weight: bold; }
        .coin-box { background: #fff; padding: 2px 8px; border-radius: 10px; border: 2px solid #ffa726; color: #ef6c00; }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ */
        .room {
            height: 180px; background: #e0f2f1; margin: 10px 0; border-radius: 10px;
            border: 3px solid #80cbc4; position: relative; display: flex; align-items: center; justify-content: center;
        }
        #character { font-size: 80px; cursor: pointer; }
        .fukidashi {
            position: absolute; top: 10px; right: 10px; background: white;
            padding: 5px 10px; border-radius: 15px; font-size: 12px; border: 2px solid #ccc;
            opacity: 0.9; max-width: 120px; display: none;
        }

        /* æ±šã‚Œãƒ»ã†ã‚“ã¡ */
        .stains { position: absolute; width: 100%; height: 100%; pointer-events: none; }
        .dirt { position: absolute; font-size: 30px; opacity: 0.7; }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
        .menu-tabs { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab-btn { flex: 1; padding: 8px; background: #d7ccc8; border: none; border-radius: 5px 5px 0 0; cursor: pointer; font-family: inherit; }
        .tab-btn.active { background: #8d6e63; color: white; }

        .action-area { background: #efebe9; padding: 10px; border-radius: 0 0 10px 10px; min-height: 150px; }
        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        
        button.action-btn {
            background: white; border: 2px solid #8d6e63; border-radius: 10px; padding: 10px;
            font-family: inherit; cursor: pointer; display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 4px 0 #d7ccc8;
        }
        button.action-btn:active { transform: translateY(3px); box-shadow: none; }
        button.action-btn span { font-size: 20px; margin-bottom: 5px; }

        .price { font-size: 10px; color: #ef6c00; font-weight: bold; background: #fff3e0; padding: 2px 5px; border-radius: 4px; margin-top: 2px; }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒã‚¤ãƒˆç”»é¢ï¼‰ */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center;
            z-index: 99; color: white; display: none;
        }
        .modal-content { background: #fff; color: #333; padding: 20px; border-radius: 15px; width: 80%; text-align: center; border: 4px solid #8d6e63; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <span id="name-display">åŠ è—¤å…ˆç”Ÿ</span>
        <div class="coin-box">ğŸ’° <span id="money">0</span> P</div>
    </div>

    <div class="room" onclick="touchCharacter()">
        <div class="fukidashi" id="speech">ãŠè…¹ã™ã„ãŸ...</div>
        <div id="character" class="shaking">ğŸ¥š</div>
        <div class="stains" id="stain-area"></div>
    </div>

    <div style="display:flex; justify-content:space-around; font-size:12px; margin-bottom:10px;">
        <span>æº€è…¹: <span id="hunger-bar">â¤â¤â¤â¤</span></span>
        <span>æ¸…æ½”: <span id="clean-bar">âœ¨âœ¨âœ¨âœ¨</span></span>
    </div>

    <div class="menu-tabs">
        <button class="tab-btn active" onclick="switchTab('care')">ãŠä¸–è©±</button>
        <button class="tab-btn" onclick="switchTab('shop')">ã‚·ãƒ§ãƒƒãƒ—</button>
        <button class="tab-btn" onclick="switchTab('work')">ãƒã‚¤ãƒˆ</button>
    </div>

    <div class="action-area">
        <div id="tab-care" class="grid-menu">
            <button class="action-btn" onclick="feed('rice')"><span>ğŸ™</span>çµ¦é£Ÿ (0P)</button>
            <button class="action-btn" onclick="bath()"><span>ğŸš¿</span>ãŠé¢¨å‘‚ (0P)</button>
            <button class="action-btn" onclick="pet()"><span>ğŸ‘‹</span>ãªã§ã‚‹ (0P)</button>
            <button class="action-btn" onclick="share()"><span>ğŸ</span>é€ã‚‹</button>
        </div>

        <div id="tab-shop" class="grid-menu hidden">
            <button class="action-btn" onclick="feed('coffee')"><span>â˜•</span>é«˜ç´šã‚³ãƒ¼ãƒ’ãƒ¼<div class="price">20P</div></button>
            <button class="action-btn" onclick="feed('sushi')"><span>ğŸ£</span>ç‰¹ä¸Šå¯¿å¸<div class="price">100P</div></button>
            <button class="action-btn" onclick="feed('drink')"><span>ğŸ¥¤</span>æ „é¤Šãƒ‰ãƒªãƒ³ã‚¯<div class="price">50P</div></button>
            <button class="action-btn" onclick="feed('cake')"><span>ğŸ°</span>ã‚±ãƒ¼ã‚­<div class="price">80P</div></button>
        </div>

        <div id="tab-work" class="hidden" style="text-align:center;">
            <p>ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã§ãƒã‚¤ãƒ³ãƒˆã‚’ç¨¼ã”ã†ï¼</p>
            <button class="action-btn" style="width:100%; background:#fff9c4;" onclick="startWork()">
                <span>ğŸ“</span>
                æ¡ç‚¹ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚’ã™ã‚‹
            </button>
            <p style="font-size:12px; margin-top:10px; color:#666;">â€»é€£æ‰“ã—ã¦æ¡ç‚¹ã‚’çµ‚ã‚ã‚‰ã›ã‚ï¼</p>
        </div>
    </div>
</div>

<div id="work-modal" class="modal">
    <div class="modal-content">
        <h3>æ¡ç‚¹ä¸­...ï¼</h3>
        <p>ãƒœã‚¿ãƒ³ã‚’é€£æ‰“ã›ã‚ˆï¼</p>
        <h1 id="work-score">0</h1>
        <button onclick="doWork()" style="width:100%; height:80px; font-size:24px; font-weight:bold; background:#ef5350; color:white; border:none; border-radius:10px;">æ¡ç‚¹ï¼</button>
    </div>
</div>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿ç®¡ç† ---
    let money = parseInt(localStorage.getItem('kato_money')) || 100;
    let hunger = 4; // 0-4
    let clean = 4;  // 0-4 (æ¸…æ½”ã•)
    let age = parseInt(localStorage.getItem('kato_age')) || 0;
    let exp = 0; // çµŒé¨“å€¤ï¼ˆé€²åŒ–ç”¨ï¼‰
    let evolutionStage = 0;
    let character = "ğŸ¥š";
    
    // ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿
    const items = {
        'rice': { price: 0, hunger: 1, exp: 1, msg: "ãƒ¢ã‚°ãƒ¢ã‚°..." },
        'coffee': { price: 20, hunger: 1, exp: 5, msg: "ç›®ãŒè¦šã‚ãŸï¼" },
        'sushi': { price: 100, hunger: 4, exp: 20, msg: "ã†ã¾ã„ï¼ï¼" },
        'drink': { price: 50, hunger: 1, exp: 10, msg: "ã¿ãªãã‚‹ï¼" },
        'cake': { price: 80, hunger: 2, exp: 15, msg: "ã‚ã¾ã€œã„ï¼" }
    };

    // ç‹¬ã‚Šè¨€ãƒªã‚¹ãƒˆ
    const speeches = [
        "ã¶ã‚‹ã¶ã‚‹...", "æ¡ç‚¹çµ‚ã‚ã‚‰ã‚“...", "å¯’ã„...", "èª°ã‹æ¥ãŸï¼Ÿ", 
        "è…¹æ¸›ã£ãŸ...", "çœ ã„...", "çµ¦æ–™æ—¥ã„ã¤ï¼Ÿ", "è…°ãŒç—›ã„"
    ];

    // åˆæœŸåŒ–
    setInterval(gameLoop, 2000); // 2ç§’ã”ã¨ã«çŠ¶æ…‹å¤‰åŒ–
    setInterval(talk, 5000); // 5ç§’ã”ã¨ã«å–‹ã‚‹
    updateUI();
    evolve();

    // --- ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ— ---
    function gameLoop() {
        // ãŠè…¹ãŒæ¸›ã‚‹ã€æ±šã‚Œã‚‹
        if (Math.random() < 0.3) hunger = Math.max(0, hunger - 1);
        if (Math.random() < 0.2) clean = Math.max(0, clean - 1);
        
        // æ±šã‚Œæç”»
        drawStains();
        updateUI();
        localStorage.setItem('kato_money', money);
        localStorage.setItem('kato_age', age);
    }

    // --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ---
    function feed(itemId) {
        const item = items[itemId];
        if (money < item.price) {
            alert("ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“ï¼ãƒã‚¤ãƒˆã—ã¦ãã ã•ã„ã€‚");
            return;
        }
        if (hunger >= 4 && item.hunger > 0 && itemId !== 'cake') { // ã‚±ãƒ¼ã‚­ã¯åˆ¥è…¹
            speak("ã‚‚ã†é£Ÿãˆãªã„...");
            return;
        }

        money -= item.price;
        hunger = Math.min(4, hunger + item.hunger);
        exp += item.exp;
        
        // é€²åŒ–ãƒã‚§ãƒƒã‚¯
        checkEvolution();
        
        speak(item.msg);
        updateUI();
    }

    function bath() {
        if (clean < 4) {
            clean = 4;
            speak("ã•ã£ã±ã‚Šã—ãŸã€œ");
            drawStains();
            updateUI();
        } else {
            speak("ã¾ã ã‚­ãƒ¬ã‚¤ã ã‚ˆ");
        }
    }

    function pet() {
        speak("ã‚„ã‚ã‚ã‚ˆw");
        // ãŸã¾ã«å°éŠ­ã‚’æ‹¾ã†
        if(Math.random() < 0.3) {
            let get = Math.floor(Math.random() * 5) + 1;
            money += get;
            speak(`ã‚ã€${get}Pè½ã¡ã¦ãŸ`);
            updateUI();
        }
    }

    // --- ãƒã‚¤ãƒˆæ©Ÿèƒ½ ---
    let workCount = 0;
    let workTimer = null;

    function startWork() {
        document.getElementById('work-modal').style.display = 'flex';
        workCount = 0;
        document.getElementById('work-score').innerText = workCount;
        
        // 5ç§’å¾Œã«çµ‚äº†
        setTimeout(() => {
            document.getElementById('work-modal').style.display = 'none';
            let salary = workCount * 10; // 1å›10ãƒã‚¤ãƒ³ãƒˆ
            money += salary;
            alert(`ãƒã‚¤ãƒˆçµ‚äº†ï¼\næ¡ç‚¹æšæ•°: ${workCount}æš\nçµ¦æ–™: ${salary}P ã‚²ãƒƒãƒˆï¼`);
            updateUI();
        }, 5000);
    }

    function doWork() {
        workCount++;
        document.getElementById('work-score').innerText = workCount;
    }

    // --- é€²åŒ–ã‚·ã‚¹ãƒ†ãƒ  ---
    function checkEvolution() {
        // çµŒé¨“å€¤(exp)ã«å¿œã˜ã¦é€²åŒ–
        if (exp > 20 && evolutionStage === 0) { age = 1; evolve(); } // ãµåŒ–
        else if (exp > 100 && evolutionStage === 1) { age = 5; evolve(); } // å­ä¾›
        else if (exp > 300 && evolutionStage === 2) { age = 20; evolve(); } // å¤§äºº
        else if (exp > 1000 && evolutionStage === 3) { age = 60; evolve(); } // ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰
    }

    function evolve() {
        if (age === 0) { character = "ğŸ¥š"; evolutionStage = 0; }
        else if (age < 5) { character = "ğŸ£"; evolutionStage = 1; }
        else if (age < 20) { character = "ğŸ‘¦"; evolutionStage = 2; }
        else if (age < 60) { character = "ğŸ‘¨â€ğŸ«"; evolutionStage = 3; }
        else { character = "ğŸ§â€â™‚ï¸"; evolutionStage = 4; } // é­”äºº
        
        document.getElementById('character').innerText = character;
    }

    // --- UIãƒ»æ¼”å‡º ---
    function switchTab(tabName) {
        document.querySelectorAll('.grid-menu, #tab-work').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        
        document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        event.target.classList.add('active'); // ç°¡æ˜“çš„ãªactiveåˆ‡ã‚Šæ›¿ãˆ
    }

    function talk() {
        const text = speeches[Math.floor(Math.random() * speeches.length)];
        speak(text);
    }

    function speak(text) {
        const bubble = document.getElementById('speech');
        bubble.innerText = text;
        bubble.style.display = 'block';
        setTimeout(() => { bubble.style.display = 'none'; }, 3000);
    }

    function drawStains() {
        const area = document.getElementById('stain-area');
        area.innerHTML = "";
        // æ¸…æ½”åº¦ãŒä¸‹ãŒã‚‹ã¨æ±šã‚Œ(ç´«ã®ãƒ¢ãƒ¤ãƒ¢ãƒ¤)ãŒã¤ã
        let dirtCount = 4 - clean;
        for(let i=0; i<dirtCount; i++) {
            let d = document.createElement('div');
            d.className = 'dirt';
            d.innerText = 'ğŸ¦ ';
            d.style.top = Math.random() * 80 + '%';
            d.style.left = Math.random() * 80 + '%';
            area.appendChild(d);
        }
    }

    function updateUI() {
        document.getElementById('money').innerText = money;
        document.getElementById('hunger-bar').innerText = "â¤".repeat(hunger) + "â™¡".repeat(4 - hunger);
        document.getElementById('clean-bar').innerText = "âœ¨".repeat(clean) + "â˜".repeat(4 - clean);
    }
    
    function touchCharacter() {
        pet();
        // ã‚¯ãƒªãƒƒã‚¯ã§å°‘ã—å¤§ããéœ‡ãˆã‚‹
        const char = document.getElementById('character');
        char.style.transform = "scale(1.2)";
        setTimeout(() => char.style.transform = "scale(1)", 100);
    }
    
    // å‹é”ã«é€ã‚‹æ©Ÿèƒ½(ç°¡æ˜“ç‰ˆ)
    function share() {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => alert("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼å‹é”ã«é€ã‚ã†ï¼"));
    }

</script>
</body>
</html>