<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ è—¤å…ˆç”Ÿã£ã¡ ãƒ•ãƒ¬ãƒ³ãƒ‰</title>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'DotGothic16', sans-serif; background-color: #e0f7fa; text-align: center; user-select: none; }
        
        /* æœ¬ä½“ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .tamagotchi-shell {
            background: linear-gradient(135deg, #4dd0e1, #00acc1);
            width: 340px; margin: 10px auto; padding: 30px 20px;
            border-radius: 60% 60% 50% 50%;
            border: 8px solid #006064;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            position: relative;
        }

        /* ç”»é¢ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .screen {
            background-color: #f1f8e9;
            border: 6px solid #546e7a;
            border-radius: 15px;
            height: 220px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
        }

        /* ãƒ¬ã‚¢åº¦ã”ã¨ã®èƒŒæ™¯è‰²å¤‰åŒ– */
        .bg-normal { background-color: #f1f8e9; }
        .bg-rare { background-color: #fff9c4; } /* é‡‘ */
        .bg-legend { background-color: #e1bee7; } /* ç´« */

        .top-bar { display: flex; justify-content: space-between; padding: 5px 10px; font-size: 14px; color: #455a64; font-weight: bold; }
        
        #character-area { height: 120px; display: flex; align-items: center; justify-content: center; font-size: 70px; position: relative; }
        .bounce { animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .poop { position: absolute; font-size: 24px; bottom: 10px; right: 20px; }

        /* ãƒœã‚¿ãƒ³ */
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 20px; }
        button {
            background: #fff; border: 3px solid #006064; border-radius: 15px; padding: 8px;
            font-family: 'DotGothic16', sans-serif; font-size: 16px; cursor: pointer;
            box-shadow: 0 4px 0 #00838f;
        }
        button:active { transform: translateY(3px); box-shadow: none; }
        
        /* ç‰¹åˆ¥ãªãƒœã‚¿ãƒ³ */
        .share-btn { grid-column: span 2; background-color: #ffeb3b; border-color: #fbc02d; color: #333; }
        .code-input { width: 70%; padding: 5px; margin-top: 10px; font-family: inherit; }

        #message { height: 20px; color: #d81b60; font-size: 14px; margin-top: 5px; font-weight: bold; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="tamagotchi-shell">
    <div class="screen" id="screen-bg">
        <div class="top-bar">
            <span><span id="generation">1</span>ä»£ç›®</span>
            <span><span id="rarity-star">â˜…</span></span>
            <span><span id="age">0</span>æ‰</span>
        </div>
        <div class="top-bar" style="margin-top:-5px; font-size:12px;">
            <span>æº€è…¹:<span id="hunger">â¤â¤â¤â¤</span></span>
            <span>æ©Ÿå«Œ:<span id="happy">â¤â¤â¤â¤</span></span>
        </div>

        <div id="character-area">
            <div id="character" class="bounce">ğŸ¥š</div>
            <div id="poops"></div>
        </div>
        
        <div id="message"></div>
    </div>

    <div class="controls" id="game-buttons">
        <button onclick="feed()">ğŸš ã”ã¯ã‚“</button>
        <button onclick="snack()">ğŸ° ãŠã‚„ã¤</button>
        <button onclick="play()">âš½ ã‚ãã¶</button>
        <button onclick="clean()">ğŸš½ ãƒˆã‚¤ãƒ¬</button>
        <button onclick="shareStatus()" class="share-btn">ğŸ“¢ å‹é”ã«è‡ªæ…¢ã™ã‚‹</button>
    </div>

    <div id="reset-area" class="hidden" style="margin-top:20px;">
        <p>æ¬¡ã®ä¸–ä»£ã¸å¼•ãç¶™ãã¾ã™ã‹ï¼Ÿ</p>
        <input type="text" id="secret-code" class="code-input" placeholder="ã‚ã„ã“ã¨ã°ãŒã‚ã‚Œã°å…¥åŠ›">
        <button onclick="resetGame()" style="width:100%; margin-top:10px; background:#81c784;">ğŸ¥š æ–°ã—ã„åµã‚’ç”£ã‚€</button>
    </div>
</div>

<script>
    // --- ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ ---
    let generation = parseInt(localStorage.getItem('kato_gen')) || 1;
    let rarity = localStorage.getItem('kato_rarity') || 'normal'; // normal, rare, legend

    // --- ã‚²ãƒ¼ãƒ è¨­å®š ---
    let hunger = 4;
    let happy = 4;
    let age = 0;
    let poopCount = 0;
    let isAlive = true;
    let character = "ğŸ¥š";
    
    // ãƒ¬ã‚¢åº¦ã”ã¨ã®è¨­å®šï¼ˆè‰²ã¨ãƒãƒ¼ã‚¯ï¼‰
    const rarityConfig = {
        'normal': { star: 'â˜…', bg: 'bg-normal', color: '#000' },
        'rare':   { star: 'â˜…â˜…', bg: 'bg-rare', color: '#d81b60' },   // ãƒ¬ã‚¢ã¯èµ¤ã£ã½ã„
        'legend': { star: 'â˜…â˜…â˜…', bg: 'bg-legend', color: '#6a1b9a' } // ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã¯ç´«
    };

    // åˆæœŸåŒ–å‡¦ç†
    function init() {
        // èƒŒæ™¯è‰²ã¨ã‚¹ã‚¿ãƒ¼ã‚’è¨­å®š
        const config = rarityConfig[rarity];
        document.getElementById('screen-bg').className = `screen ${config.bg}`;
        document.getElementById('rarity-star').innerText = config.star;
        document.getElementById('character').style.color = config.color;
        document.getElementById('generation').innerText = generation;
        
        evolve();
        updateScreen();
    }

    // --- ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ— ---
    setInterval(() => {
        if (!isAlive) return;

        if (Math.random() < 0.2) hunger--;
        if (Math.random() < 0.2) happy--;
        if (Math.random() < 0.15) makePoop();
        
        // 10ç§’ã§1æ­³ï¼ˆãƒ†ã‚¹ãƒˆç”¨ã«é«˜é€ŸåŒ–ï¼‰
        if (new Date().getSeconds() % 10 === 0) {
            age++;
            evolve();
        }
        checkStatus();
        updateScreen();
    }, 1000);

    // --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ---
    function feed() { action(() => { if(hunger<4) { hunger++; msg("ã†ã¾ï¼"); } else msg("æº€è…¹ã "); }); }
    function snack() { action(() => { if(happy<4) { happy++; hunger=Math.max(0,hunger-1); msg("ã‚ã¾ã€œã„"); } }); }
    function play() { action(() => { if(happy<4) { happy++; hunger--; msg("ã‚¦ã‚§ãƒ¼ã‚¤ï¼"); } }); }
    function clean() { action(() => { if(poopCount>0) { poopCount=0; happy++; msg("ã‚¹ãƒƒã‚­ãƒªï¼"); } else msg("ãã‚Œã„ã ã‚ˆ"); }); }
    
    function action(func) {
        if (!isAlive) return;
        func();
        updateScreen();
    }

    function makePoop() { if (poopCount < 4) { poopCount++; msg("ãƒ–ãƒªãƒƒ"); } }

    // --- é€²åŒ–ï¼†ãƒ¬ã‚¢åº¦åˆ†å² ---
    function evolve() {
        // ãƒ¬ã‚¢åº¦ã«ã‚ˆã£ã¦è¦‹ãŸç›®ãŒå¤‰ã‚ã‚‹
        if (age < 5) {
            character = rarity === 'legend' ? "ğŸ‰" : (rarity === 'rare' ? "ğŸ£" : "ğŸ¥š");
        } else if (age < 15) {
            character = rarity === 'legend' ? "ğŸ‘½" : (rarity === 'rare' ? "ğŸ˜" : "ğŸ‘¦");
        } else {
            // å¤§äºº
            if (rarity === 'legend') character = "ğŸ§â€â™‚ï¸"; // é­”äººåŠ è—¤
            else if (rarity === 'rare') character = "ğŸ¤´"; // ç‹å­åŠ è—¤
            else character = "ğŸ‘¨â€ğŸ«"; // æ™®é€šã®åŠ è—¤
        }
    }

    function checkStatus() {
        hunger = Math.max(0, Math.min(4, hunger));
        happy = Math.max(0, Math.min(4, happy));

        // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ˆå®¶å‡º or çµå©šå¼•é€€ï¼‰
        if (hunger === 0 || poopCount >= 4) {
            endGame("å®¶å‡ºã—ã¾ã—ãŸ...", "ğŸƒğŸ’¨");
        } else if (age >= 30) {
            endGame("çµå©šã—ã¦å¼•é€€ï¼", "ğŸ’’"); // ãƒãƒƒãƒ”ãƒ¼ã‚¨ãƒ³ãƒ‰
        }
    }

    function endGame(text, icon) {
        isAlive = false;
        msg(text);
        character = icon;
        document.getElementById("game-buttons").classList.add("hidden");
        document.getElementById("reset-area").classList.remove("hidden");
    }

    // --- ä¸–ä»£äº¤ä»£ï¼†ã‚ã„ã“ã¨ã°ã‚·ã‚¹ãƒ†ãƒ  ---
    function resetGame() {
        const code = document.getElementById('secret-code').value;
        let nextRarity = 'normal';

        // ã‚ã„ã“ã¨ã°åˆ¤å®šï¼ˆã“ã“ã‚’å‹é”ã¨å…±æœ‰ï¼ï¼‰
        if (code === "KATO-GOD") nextRarity = 'legend';
        else if (code === "KATO-LOVE") nextRarity = 'rare';
        else {
            // ãƒ©ãƒ³ãƒ€ãƒ æŠ½é¸
            const rand = Math.random();
            if (rand < 0.05) nextRarity = 'legend'; // 5%
            else if (rand < 0.2) nextRarity = 'rare'; // 15%
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ãƒªãƒ­ãƒ¼ãƒ‰
        localStorage.setItem('kato_gen', generation + 1);
        localStorage.setItem('kato_rarity', nextRarity);
        location.reload();
    }

    // --- ã‚·ã‚§ã‚¢æ©Ÿèƒ½ï¼ˆSNSã§è‡ªæ…¢ï¼‰ ---
    function shareStatus() {
        const text = `ã€åŠ è—¤å…ˆç”Ÿã£ã¡ã€‘\nç¾åœ¨ã¯${generation}ä»£ç›®ï¼\nãƒ¬ã‚¢åº¦: ${rarityConfig[rarity].star}\nå¹´é½¢: ${age}æ‰\nåŠ è—¤å…ˆç”Ÿã‚’è‚²æˆä¸­ï¼\n#åŠ è—¤å…ˆç”Ÿã£ã¡`;
        
        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        navigator.clipboard.writeText(text).then(() => {
            alert("ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nLINEã‚„Xã«è²¼ã‚Šä»˜ã‘ã¦è‡ªæ…¢ã—ã‚ˆã†ï¼");
        });
    }

    function updateScreen() {
        document.getElementById("hunger").innerText = "â¤".repeat(hunger) + "â™¡".repeat(4 - hunger);
        document.getElementById("happy").innerText = "â¤".repeat(happy) + "â™¡".repeat(4 - happy);
        document.getElementById("age").innerText = age;
        document.getElementById("character").innerText = character;

        const poopArea = document.getElementById("poops");
        poopArea.innerHTML = "";
        for(let i=0; i<poopCount; i++) {
            let p = document.createElement("div");
            p.className = "poop";
            p.innerText = "ğŸ’©";
            p.style.right = (i * 25 + 5) + "px";
            poopArea.appendChild(p);
        }
    }

    function msg(text) {
        document.getElementById("message").innerText = text;
        setTimeout(() => document.getElementById("message").innerText = "", 2000);
    }

    init();
</script>
</body>
</html>